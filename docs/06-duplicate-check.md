# チケット06: 重複チェック機能

## 概要
ツイートインポート時の重複検出と警告表示機能の実装

## 目的
- 同一ツイートの重複使用防止
- スパム判定リスクの軽減
- ユーザーへの適切な警告提供

## タスク一覧

### ユーティリティ関数
- [ ] duplicateChecker.ts の詳細実装
- [ ] 類似度計算アルゴリズムの実装
- [ ] ハッシュ生成関数の実装

### コンポーネント開発
- [ ] DuplicateWarningModal.tsx の作成
- [ ] DuplicateList.tsx の作成（重複一覧）
- [ ] SimilarityBadge.tsx の作成（類似度表示）

### 機能実装
- [ ] 完全一致の検出
- [ ] 部分一致の検出（DMリンク除外後）
- [ ] 類似度計算（編集距離ベース）
- [ ] 重複ツイートのハイライト表示
- [ ] 重複を無視してインポートするオプション
- [ ] 重複を除外してインポートするオプション

### UI/UX
- [ ] 警告モーダルのデザイン
- [ ] 重複ツイートの並列表示
- [ ] アクションボタン（続行/キャンセル/除外）
- [ ] 重複数のバッジ表示

## 受け入れ条件
- インポート時に重複が検出されること
- 重複内容が明確に表示されること
- ユーザーが選択可能なオプションが提供されること
- パフォーマンスが許容範囲内であること（1000件で1秒以内）

## 技術詳細
```typescript
// utils/duplicateChecker.ts
export interface DuplicateCheckResult {
  hasDuplicates: boolean;
  duplicates: Array<{
    newTweet: string;
    existingTweet: Tweet;
    similarity: number; // 0-100%
    type: 'exact' | 'similar';
  }>;
}

export function checkDuplicates(
  newTweets: string[],
  existingTweets: Tweet[]
): DuplicateCheckResult {
  // 実装
  // 1. DMリンクを除外して比較
  // 2. 空白・改行を正規化
  // 3. ハッシュタグ部分を除外して比較
}

// 類似度計算（レーベンシュタイン距離）
function calculateSimilarity(str1: string, str2: string): number {
  // 実装
}
```

## アルゴリズム詳細
1. **前処理**
   - DMリンクの除去
   - 空白・改行の正規化
   - 小文字変換

2. **比較方法**
   - 完全一致: ハッシュ値での高速比較
   - 類似判定: 編集距離が閾値以下（90%以上の類似度）

3. **パフォーマンス最適化**
   - Map/Setを使用した高速検索
   - 早期リターンの実装

## UIデザイン
```
┌─────────────────────────────────┐
│  ⚠️ 重複ツイートが検出されました    │
├─────────────────────────────────┤
│  3件の重複が見つかりました：        │
│                                 │
│  [既存] ツイート内容...          │
│  [新規] ツイート内容...          │
│  類似度: 95%                    │
│                                 │
├─────────────────────────────────┤
│ [除外してインポート] [すべてインポート] [キャンセル] │
└─────────────────────────────────┘
```

## 備考
- 類似度90%以上を重複として扱う
- DMリンク部分は比較から除外
- ハッシュタグの順序違いは重複としない